<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>资产查询清单</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
	<link rel="stylesheet" href="../../layui/css/layui.css" media="all" />
	<style>
		html,body{
			width: 100%;
			height: 100%;
		}
		body .layui-tree-skin-shihuang .layui-tree-branch{color: #EDCA50;}    
		.childrenBody{
			width: 100%;
			height: 100%;
			padding: 15px 0;
			overflow: hidden;
		}
		.addPeople,#chooseAuthority,#addDepartment{
			padding: 15px 0;
		} 
		
		.addPeople .layui-input-block,.editPeople .layui-input-block{
			margin-right: 20px;
		}
		#chooseAuthority .layui-input-block,.editPeople .layui-input-block{
			margin-right: 20px;
		}
		#addDepartment .layui-input-block,.editPeople .layui-input-block{
			margin-right: 20px;
		}
		.peopleTable{
			margin-left:-25px;
		}
		.red{
			color: red;
		}
		.uploadExcelTitle{
			line-height:50px;
			font-weight: 600;
		}
		#uploadExcel{
			padding: 20px;
		}
		#chooseFile{
		
			height: 30px;
			background: #6866E9;
			opacity: 0.7;
			line-height: 30px;
			border-radius: 15px ;
			font-size: 14px;
			text-align: center;
		}
		#chooseFile:hover{
			opacity: 1;
		}
		#uploadBtn{
	
			height: 30px;
			background: #46CE4E;
			opacity: 0.7;
			line-height: 30px;
			border-radius: 15px ;
			font-size: 14px;
			text-align: center;
			margin-left: 10px;
		}
		#uploadBtn:hover{
			opacity: 1;
		}
		.startUpload{
			margin-top: 10px;
		}
		.startUpload a:-webkit-any-link {
	    color: -webkit-link;
	    cursor: auto;
	    text-decoration: underline;
		}
		.organizationTitle{
			height: 40px;
			line-height: 40px;
			background: #e2e1eb;
			margin-top: 20px;
			padding-left: 10px;
			font-size: 14px;
			font-weight: 600;
		}
		.red{
			color: red;
		}
		
		/*导入文件*/
		.uploadExcelTitle{
			line-height:50px;
			font-weight: 600;
		}
		#uploadExcel_Organization,#uploadExcel_department{
			padding: 20px;
		}
		#chooseFile{
			height: 30px;
			background: #6866E9;
			opacity: 0.7;
			line-height: 30px;
			border-radius: 15px ;
			font-size: 14px;
			text-align: center;
		}
		#chooseFile:hover{
			opacity: 1;
		}
		#uploadBtn{
			height: 30px;
			background: #46CE4E;
			opacity: 0.7;
			line-height: 30px;
			border-radius: 15px ;
			font-size: 14px;
			text-align: center;
			margin-left: 10px;
		}
		#uploadBtn:hover{
			opacity: 1;
		}
		.startUpload{
			margin-top: 10px;
		}
		.startUpload a:-webkit-any-link {
		    color: -webkit-link;
		    cursor: auto;
		    text-decoration: underline;
		}
		
		#addOrganization {
			padding: 15px 0;
		} 
		
		#addOrganization .layui-input-block{
			margin-right: 20px;
		}
		#btns{
			height: 30px;
			background: #6866E9;
			opacity: 0.7;
			line-height: 30px;
			border-radius: 15px ;
			font-size: 14px;
			text-align: center;
		}
		#btns:hover{
			opacity: 1;
		}
		#btns1{
			height: 30px;
			background: #6866E9;
			line-height: 30px;
			border-radius: 15px ;
			font-size: 14px;
			text-align: center;
			opacity: 1;
		}
	
		#delBtn{
			height: 30px;
			opacity: 0.7;
			line-height: 30px;
			border-radius: 15px ;
			font-size: 14px;
			text-align: center;
		}
		#delBtn:hover{
			opacity: 1;
		}
		.newBox{
			display: inline-block;
			margin-right: 10px;
			position: relative;
		}
		.newBtns{
			display: none;
			position:absolute;
			left: 0;
			top:30px;
		}
		.dataTitle{
			line-height:38px;
			padding: 0 10px;
		}
	</style>
</head>
<body class="childrenBody">
	<div class="layui-fluid">
		<div class="layui-row organizationBox">
	     	<div class="layui-row">
				<!--<div class="layui-col-md1" style="text-align: right;">
					<span class="dataTitle">报废日期:</span>
				</div>-->
		     	<div class="layui-row layui-col-md7">
		     		<div class="layui-inline">
			     		<label class="layui-form-label" style="width: auto;">报废日期:</label>
				   		 <div class="layui-input-inline">	
			    			<input type="text" class="layui-input" id="startDate" placeholder="yyyy-mm-dd">
			     		</div>
		     		</div>
		     		<div class="layui-inline">
		     			<label class="layui-form-label" style="width: auto; padding: 9px 6px;">至</label>
			     		<div class="layui-input-inline">	
			    			<input type="text" class="layui-input" id="endDate" placeholder="yyyy-mm-dd">
			     		</div>
		     		</div>
		     		<div class="layui-inline">
		     			<button class="layui-btn"  id="btns"  data-type="auto" style="margin-left: 10px;" data-method='loadExcel'>导出</button>
		     		</div>
			   	</div>
			  <!-- 	<div class="layui-row layui-col-md2">
			   	<div class="layui-input-inline">	
		    			<input type="text" class="layui-input" id="endDate" placeholder="选择结束日期">
		     		</div>
		     	</div>	-->
		     	<!--<div class="layui-row layui-col-md2" style="line-height: 38px;">
			   		<button class="layui-btn"  id="btns"  data-type="auto" style="margin-left: 10px;" data-method='loadExcel'>导出</button>
			   	</div>-->
	     	</div>
	   	 	<div class="layui-row">
		    		<table id="scrapData" lay-filter="roleDataFilter"></table>
	     	</div>
	  </div>
  </div>
</div>

    

	<script type="text/javascript" src="../../layui/layui.js"></script>
	<script type="text/javascript" src="../../js/peizhi.js"></script>
	<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
<!--[if lt IE 9]>
  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->
	<script type="text/javascript">
		
	layui.use(['layer','jquery','table','form','laydate'], function(){
		var apiUrl=ApiUrl;
		$ = layui.jquery;
		var laydate = layui.laydate;
		var table = layui.table,
		 layer = layui.layer,
		 form = layui.form;
		 var startDateTime='',endDateTime='';
		 var startDate='';
		 var endDateTime='';
	
var startDate1 = layui.laydate.render({
	elem: '#startDate',
	done:function(value,date){
	startDate=date.year+'-'+date.month+'-'+date.date;
	if( value !== '' ){
		endDate1.config.min.year = date.year;
		endDate1.config.min.month = date.month - 1;
		endDate1.config.min.date = date.date;
	}else{
		endDate1.config.min.year = '';
		endDate1.config.min.month = '';
		endDate1.config.min.date = '';
	}
	if($('#endDate').val()!=''&&$('#startDate').val()!=''){
		table.reload('scrapData', {
					url: apiUrl+'dump/getalldumpinglist'
					,where:{
						"startTime":startDate
						,"endTime":endDateTime
					}
				})
	}
}
});


var endDate1 = layui.laydate.render({
elem: '#endDate',
done:function(value,date){
	endDateTime=date.year+'-'+date.month+'-'+date.date;
	if( value !== '' ){
		startDate1.config.max.year = date.year;
		startDate1.config.max.month = date.month - 1;
		startDate1.config.max.date = date.date;
	}else{
		startDate1.config.max.year = '';
		startDate1.config.max.month = '';
		startDate1.config.max.date = '';
	}
	
	if($('#endDate').val()!=''&&$('#startDate').val()!=''){
		table.reload('scrapData', {
					url: apiUrl+'dump/getalldumpinglist'
					,where:{
						"startTime":startDate
						,"endTime":endDateTime
					}
				})
	}
}
});
		  
		  
		  
//展示已知数据
  table.render({
    elem: '#scrapData'
    ,id:'scrapData'
    ,url:apiUrl+'dump/getalldumpinglist'
    ,height: 'full-65'
    ,cols: [[ //标题栏
      {field: 'propertyCode', title: '资产条码', width: 170, sort: false}
      ,{field: 'propertyName', title: '资产名称', width: 156}
      ,{field: 'categoryCode', title: '分类编码', width: 96}
      ,{field: 'categoryName', title: '分类名称', width: 96}
      ,{field: 'price', title: '金额', width: 96}
      ,{field: 'specification', title: '规格', width: 96}
      ,{field: 'unit', title: '单位', width: 96}
      ,{field: 'organizationCode', title: '机构编码', width: 96}
      ,{field: 'organizationName', title: '机构名称', width: 136}
      ,{field: 'deptCode', title: '部门编码', width: 96}
      ,{field: 'deptName', title: '部门名称', width: 136}
      ,{field: 'depositAdress', title: '存放地', width: 96}
      ,{field: 'storageinDate', title: '入库时间', width: 96}
      ,{field: 'serviceLife', title: '使用期限', width: 96}
      ,{field: 'dumpingDate', title: '报废时间', width: 96}
      ,{field: 'dealUserName', title: '报废处理人', width: 126}
      ,{field: 'remark', title: '备注', width: 96}
    ]] 
    //,skin: 'row' //表格风格
    ,even: false
    ,page: true //是否显示分页
    ,limits: [20, 50, 100]
    ,limit: 20 //每页默认显示的数量
  });		
		
		 //触发事件
  var active = {
  /*  loadExcel:function(){
    	if(startDate){
    		$.ajax({
    		type:"get",
    		url:apiUrl+"dump/downdumplist",
    		async:true,
    		data:{
				"startTime":startDate
				,"endTime":endDateTime
				},
    		success:function(data){
    			console.log(data)
    		}
    	});
    	}else{
    		layer.msg('请选择要导出数据的时间段')
    	}
    }*/
   loadExcel:function(){
    	//var src=$(this).attr('url');
    	var src=apiUrl+"dump/downdumplist"
	        if(browserIsIe()){//假如是ie浏览器  
	                DownLoadReportIMG(src);  
	        }else{  
	               NotIeDown(src,'模版')
	        }  
	    function DownLoadReportIMG(imgPathURL) {  
    //如果隐藏IFRAME不存在，则添加  
	    if (!document.getElementById("IframeReportImg"))  
	        $('<iframe style="display:none;" id="IframeReportImg" name="IframeReportImg" onload="DoSaveAsIMG();" width="0" height="0" src="about:blank"></iframe>').appendTo("body");  
	    if (document.all.IframeReportImg.src != imgPathURL) {  
	        //加载图片  
	        document.all.IframeReportImg.src = imgPathURL;  
	    }  
	    else {  
	        //图片直接另存为 
	        DoSaveAsIMG();  
	    }  
	}  
	function DoSaveAsIMG() {  
		if (document.all.IframeReportImg.src != "about:blank")  
		window.frames["IframeReportImg"].document.execCommand("SaveAs");  
	}  
	//判断是否为ie浏览器  
	function browserIsIe() {  
	    if (!!window.ActiveXObject || "ActiveXObject" in window)  
	        return true;  
	    else  
	        return false;  
	} 
	function NotIeDown(src,name){
	      var a = document.createElement("a");
	            a.href = src;
	            a.download =name;
	            a.click();
	} 
    }
   
  };
  
    //按钮
  $('.organizationBox .layui-btn').on('click', function(){
    var othis = $(this), method = othis.data('method');
    active[method] ? active[method].call(this, othis) : '';
  });

})
	</script>
</body>


    


</html>